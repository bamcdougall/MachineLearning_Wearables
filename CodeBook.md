---
title: 'Wearable Transducers:  Transforming Experimental Data into Analytic Data'
author: "Brendan McDougall"
date: "Friday, April 24, 2015"
output: html_document
---

##Abstract

Wearable Transducers, e.g. FitBit or smart phones, allow users to collect myriad sets of personal data.  A variety of tranducers, datalogging methods, data compression algorithms, some overlayed by proprietary methods result in a disjoint collection of data (*data hive*).  Ultimately, an end user requires a coherent, simple dataset that is abstracted from a data hive.

This R-script demonstrates a method for post-processing a model *data hive* [1] into *Tidy Data* [2].  For the model *data hive*, data are *open source*, i.e. readily accessible.  The data are partitioned into multiple files and directories.  Since the data are targeted for machine learning, there are two sets of data: training data and test data.  There also are additional files that contain, for example, variable names.

For this work, Tidy Data is generated by using a R data.frame that is written to a text formatted file.  The exported txt file provides summary tidy data ready for immediate review by an end user.

A review of Tidy Data is beyond the scope of this paper.  The reader is referred to the literature [2](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=2&cad=rja&uact=8&ved=0CCcQFjAB&url=http%3A%2F%2Fwww.jstatsoft.org%2Fv59%2Fi10%2Fpaper&ei=eSE9VfX3DIa4oQSA-IGQAQ&usg=AFQjCNFKII3Uv4EjwO-x6tt2F1zLHb_pkw).

###Method:

The *data hive* is experimental data obtained from a Samsung (SEC) Galaxy S smartphone.  Data
are in the UCI Machine Learning Repository.  From the experimental *data hive*, 
-1  Prepare a tidy data for later analysis with an R-script provided by the end-user.
-2  Provide a link to a Github repository with the R-Script that transforms the experimental data
into tidy analytic data.
-3  Provide a code book titled **CodeBook.md** that describes data, variables, and transformations of
the *data hive*.  (This file)
-4  Provide a README.md in the GitHub Repository that explains the method to post-process the *data hive* with the R-Script.  

###Brief Description of the *Data Hive*
Here is the link to a [Description of Data Hive](http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones)

Here is a link to the [Data Hive](https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip)
[61Mb]

**The following information is excerpted directly from the host repository of UCI.**

***

###Data Set Information:

The experiments have been carried out with a group of 30 volunteers within an age bracket of 19-48 years. Each person performed six activities (WALKING, WALKING_UPSTAIRS, WALKING_DOWNSTAIRS, SITTING, STANDING, LAYING) wearing a smartphone (Samsung Galaxy S II) on the waist. Using its embedded accelerometer and gyroscope, we captured 3-axial linear acceleration and 3-axial angular velocity at a constant rate of 50Hz. The experiments have been video-recorded to label the data manually. The obtained dataset has been randomly partitioned into two sets, where 70% of the volunteers was selected for generating the training data and 30% the test data. 

The sensor signals (accelerometer and gyroscope) were pre-processed by applying noise filters and then sampled in fixed-width sliding windows of 2.56 sec and 50% overlap (128 readings/window). The sensor acceleration signal, which has gravitational and body motion components, was separated using a Butterworth low-pass filter into body acceleration and gravity. The gravitational force is assumed to have only low frequency components, therefore a filter with 0.3 Hz cutoff frequency was used. From each window, a vector of features was obtained by calculating variables from the time and frequency domain.

Check the README.txt file for further details about this dataset. 

A video of the experiment including an example of the 6 recorded activities with one of the participants can be seen in the following link: [Web Link]


###Attribute Information:

For each record in the dataset it is provided: 
- Triaxial acceleration from the accelerometer (total acceleration) and the estimated body acceleration. 
- Triaxial Angular velocity from the gyroscope. 
- A 561-feature vector with time and frequency domain variables. 
- Its activity label. 
- An identifier of the subject who carried out the experiment.

***

##Data Processing

The R-script titled **run_analysis.R** executes:

- Merges the training and the test sets to create one data set.
- Extracts only the mean and standard deviation for each measurement data set.
- Assign descriptive names for each activity of the dataset.
- Generate an average of each variable for each activity and each subject.

R-Packages are loaded that provide functions for assembling tidy data.  These libraries include 

- **reshape2**,
- **tidyr**, [Tidy Data]()
- **dplyr**, [Package 'dplyr'](http://cran.r-project.org/web/packages/dplyr/dplyr.pdf).

The referenced libraries along with additional libraries are loaded into R-Studio with commands:

```r
library(reshape2)
library(tidyr)
library(dplyr)
```


Data are read from six data files and two "header files".  The following code chunk shows data loading:


```r
features <- read.table('features.txt')
activityLabels <- read.table('activity_labels.txt')

xTestData <- tbl_df( read.table( 'test/X_test.txt' ) )
xTrainData <- tbl_df( read.table( 'train/X_train.txt' ))
testSubjects <- tbl_df( read.table( 'test/subject_test.txt' ))
trainSubjects <- tbl_df( read.table( 'train/subject_train.txt' ))
yTestActivity <- tbl_df( read.table( 'test/y_test.txt' ))
yTrainData <- tbl_df( read.table( 'train/y_train.txt' ))

VarsFromFiles <- ls()
View(VarsFromFiles)
```

Afterwards the data are transformed into a well-annotated data.frame with the following code chunk:

```r
# naming columns to make vector handling more clear
colnames(yTrainData) <- c("activity")
colnames(yTestActivity) <- c("activity")
colnames(testSubjects) <- c("subject")
colnames(trainSubjects) <- c("subject")

# Pulling vector of names from features table
# Prevent many to one names 
namesVector <- as.character(features$V2)
colnames(xTrainData) <- make.names(namesVector, unique=TRUE)
colnames(xTestData) <- make.names(namesVector, unique=TRUE)

trainAll <- cbind(trainSubjects, yTrainData, xTrainData) # was xTrainCombined
testAll <- cbind(testSubjects, yTestActivity, xTestData) #was xTestCombined

# Introduce factor variable to enable group_by summary; 
# Note added in proof:  ended up not using this, but may try again later
trainAll$originFac = c("train")
testAll$originFac = c("test")

# Final combining
trainTestAllTbldf <- tbl_df( rbind(trainAll, testAll) )


trainTestAllTbldfMeans <- select(trainTestAllTbldf, subject, activity, grep("\\.mean\\.|\\.std\\.", names(trainTestAllTbldf)))
trainTestAllTbldfMeans$activity <- factor(trainTestAllTbldfMeans$activity, levels=activityLabels$V1, labels=activityLabels$V2)
trainTestAllTbldf.melt <- melt(trainTestAllTbldfMeans,id=c("subject","activity"),measure.vars=names(select(trainTestAllTbldfMeans, -subject, -activity)))

# Calculating the mean of each feature grouped by activity and subject -> s/sqrt(n) estimate of parent population
trainTestAllTbldf.summarised <- summarise(group_by(trainTestAllTbldf.melt, subject, activity, variable), mean=mean(value))

# Chunking separate columns for mean and std; more clear names for variables
trainTestAllTbldf.cbind <- cbind(trainTestAllTbldf.summarised, estimatedValue=sub('^.*(mean|std).*$', "\\1", trainTestAllTbldf.summarised$variable))
trainTestAllTbldf.cbind$variable = gsub('\\.*|mean|std', '', trainTestAllTbldf.cbind$variable)
trainTestAllTbldf.cbind <- spread(trainTestAllTbldf.cbind, estimatedValue, mean)
trainTestAllTbldf.tidy <- rename(trainTestAllTbldf.cbind, feature=variable)
trainTestAllTbldf.tidy <- rename(trainTestAllTbldf.tidy, meanMean=mean)
trainTestAllTbldf.tidy <- rename(trainTestAllTbldf.tidy, meanStd=std)
trainTestAllTbldf.tidy$feature <- sub('Acc', 'Acceleration', trainTestAllTbldf.tidy$feature)
trainTestAllTbldf.tidy$feature <- sub('Mag', 'Magnitude', trainTestAllTbldf.tidy$feature)
trainTestAllTbldf.tidy$feature <- sub('Gyro', 'AngularVelocity', trainTestAllTbldf.tidy$feature)
trainTestAllTbldf.tidy$feature <- sub('BodyBody', 'Body', trainTestAllTbldf.tidy$feature)
trainTestAllTbldf.tidy$feature <- sub('^t', 'Time', trainTestAllTbldf.tidy$feature)
trainTestAllTbldf.tidy$feature <- sub('^f', 'Frequency', trainTestAllTbldf.tidy$feature)
```


##Results

The code provides a path from experimental data to tidy analytic data.

##References

[1] Davide Anguita, Alessandro Ghio, Luca Oneto, Xavier Parra and Jorge L. Reyes-Ortiz. Human Activity Recognition on Smartphones using a Multiclass Hardware-Friendly Support Vector Machine. International Workshop of Ambient Assisted Living (IWAAL 2012). Vitoria-Gasteiz, Spain. Dec 2012
